@page
@model Application_Security_Practical_Assignment.Pages.Account.ResetPasswordModel
@{
    ViewData["Title"] = "Reset Password";
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-6 col-lg-5">
            <div class="card shadow-sm">
                <div class="card-body p-4">

                    <h2 class="mb-1">Reset Password</h2>
                    <p class="text-muted mb-4">Enter your new password.</p>

                    <form method="post" novalidate>
                        @Html.AntiForgeryToken()

                        <input type="hidden" asp-for="Input.Email" />
                        <input type="hidden" asp-for="Input.Token" />

                        <!-- Display server errors -->
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <!-- New Password -->
                        <div class="mb-3">
                            <label asp-for="Input.NewPassword" class="form-label"></label>

                            <input asp-for="Input.NewPassword"
                                   id="passwordInput"
                                   type="password"
                                   class="form-control @(ViewData.ModelState["Input.NewPassword"]?.Errors.Count > 0 ? "is-invalid" : "")"
                                   autocomplete="new-password" />

                            <span asp-validation-for="Input.NewPassword"
                                  class="invalid-feedback d-block"></span>

                            <!-- Password strength UI -->
                            <div class="mt-3 small" id="passwordRules">

                                <div class="fw-semibold mb-1">
                                    Strength:
                                    <span id="strengthText" class="text-danger">Weak</span>
                                </div>

                                <ul class="mb-0 ps-3">
                                    <li id="lengthRule" class="text-danger">At least 12 characters</li>
                                    <li id="upperRule" class="text-danger">Uppercase letter</li>
                                    <li id="lowerRule" class="text-danger">Lowercase letter</li>
                                    <li id="numberRule" class="text-danger">Number</li>
                                    <li id="symbolRule" class="text-danger">Symbol</li>
                                </ul>

                            </div>
                        </div>

                        <!-- Confirm -->
                        <div class="mb-3">
                            <label asp-for="Input.ConfirmPassword" class="form-label"></label>
                            <input asp-for="Input.ConfirmPassword"
                                   type="password"
                                   class="form-control @(ViewData.ModelState["Input.ConfirmPassword"]?.Errors.Count > 0 ? "is-invalid" : "")"
                                   autocomplete="new-password" />

                            <span asp-validation-for="Input.ConfirmPassword"
                                  class="invalid-feedback d-block"></span>
                        </div>

                        <button class="btn btn-primary w-100">
                            Reset Password
                        </button>

                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <!-- Strength meter script -->
    <script>
        const passwordInput = document.getElementById("passwordInput");
        const strengthText = document.getElementById("strengthText");

        const rules = {
            length: document.getElementById("lengthRule"),
            upper: document.getElementById("upperRule"),
            lower: document.getElementById("lowerRule"),
            number: document.getElementById("numberRule"),
            symbol: document.getElementById("symbolRule")
        };

        passwordInput.addEventListener("input", function () {
            const val = passwordInput.value;

            const checks = {
                length: val.length >= 12,
                upper: /[A-Z]/.test(val),
                lower: /[a-z]/.test(val),
                number: /[0-9]/.test(val),
                symbol: /[^A-Za-z0-9]/.test(val)
            };

            let score = 0;

            for (let key in checks) {
                if (checks[key]) {
                    rules[key].classList.remove("text-danger");
                    rules[key].classList.add("text-success");
                    score++;
                } else {
                    rules[key].classList.remove("text-success");
                    rules[key].classList.add("text-danger");
                }
            }

            // strength text
            if (score <= 2) {
                strengthText.textContent = "Weak";
                strengthText.className = "text-danger";
            }
            else if (score <= 4) {
                strengthText.textContent = "Medium";
                strengthText.className = "text-warning";
            }
            else {
                strengthText.textContent = "Strong";
                strengthText.className = "text-success";
            }
        });
    </script>
}
